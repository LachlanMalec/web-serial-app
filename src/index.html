<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Serial Connection Demo</title>
</head>

<body>
  <h1>Serial Connection Demo</h1>
  <label for="baudRate">Baud Rate:</label>
  <input type="number" id="baudRate" value="9600">
  <button id="connect">Connect to Serial Device</button>
  <div id="output"></div>

  <script>
    document.getElementById('connect').addEventListener('click', async () => {
      const baudRate = parseInt(document.getElementById('baudRate').value, 10);

      if ('serial' in navigator) {
        try {
          const port = await navigator.serial.requestPort();
          await port.open({ baudRate: baudRate });

          const reader = port.readable.getReader();
          while (true) {
            const { value, done } = await reader.read();
            if (done) {
              reader.releaseLock();
              break;
            }
            console.log(value);
            document.getElementById('output').innerHTML += value;
          }
        } catch (e) {
          console.error('There was an error opening the serial port:', e);
          document.getElementById('output').innerHTML = e;
        }
      } else {
        console.log('Web Serial API not supported.');
        document.getElementById('output').innerHTML = 'Web Serial API not supported.';
      }
    });

    function sendDataToServer(data) {
        fetch('/write', {
            method: 'POST',
            body: data
        }).then(response => {
            if (response.ok) {
                console.log('data send to server');
            } else {
                console.error('error sending data to server');
            }
        }).catch(error => {
            console.error('error:', error);
        });
    }
  </script>
</body>

</html>